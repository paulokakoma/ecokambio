#!/usr/bin/expect -f

#######################################################################
# Script Expect - InstalaÃ§Ã£o Remota Automatizada
# Executa o script de instalaÃ§Ã£o no servidor Contabo
#######################################################################

set timeout 600
set server_ip "212.90.120.135"
set server_user "root"
set server_pass "1234"

puts "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
puts " ğŸš€ InstalaÃ§Ã£o Remota no Servidor Contabo"
puts "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"

# Fazer upload do script de instalaÃ§Ã£o
puts "ğŸ“¤ Fazendo upload do script de instalaÃ§Ã£o...\n"
spawn scp scripts/install_contabo.sh $server_user@$server_ip:/root/
expect {
    "password:" {
        send "$server_pass\r"
        exp_continue
    }
    "yes/no" {
        send "yes\r"
        exp_continue
    }
    eof
}

puts "\nâœ… Upload concluÃ­do\n"

# Conectar e executar instalaÃ§Ã£o
puts "ğŸ”§ Executando instalaÃ§Ã£o no servidor...\n"
spawn ssh $server_user@$server_ip "cd /root && bash install_contabo.sh"
expect {
    "password:" {
        send "$server_pass\r"
        exp_continue
    }
    "yes/no" {
        send "yes\r"
        exp_continue
    }
    eof
}

puts "\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
puts " âœ… InstalaÃ§Ã£o remota concluÃ­da!"
puts "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"
puts "ğŸ“ PrÃ³ximo passo: Fazer upload dos arquivos da aplicaÃ§Ã£o"
puts "    Execute: bash scripts/deploy_to_contabo.sh\n"
