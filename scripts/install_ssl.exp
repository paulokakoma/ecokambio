#!/usr/bin/expect -f

#######################################################################
# Script Expect - InstalaÃ§Ã£o SSL Automatizada
# Instala certificado SSL via Certbot
#######################################################################

set timeout 300
set server_ip "212.90.120.135"
set server_user "root"
set server_pass "1234"
set domain "ecokambio.com"
set email "admin@ecokambio.com"

puts "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
puts " ğŸ” Instalando Certificado SSL (Let's Encrypt)"
puts "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"
puts "ğŸ“§ Email: $email"
puts "ğŸŒ DomÃ­nio: $domain, www.$domain\n"

# Executar Certbot
spawn ssh $server_user@$server_ip "certbot --nginx -d $domain -d www.$domain --non-interactive --agree-tos --email $email --redirect"

expect {
    "password:" {
        send "$server_pass\r"
        exp_continue
    }
    "Enter email address" {
        send "$email\r"
        exp_continue
    }
    "Please read the Terms of Service" {
        send "Y\r"
        exp_continue
    }
    "Would you be willing" {
        send "N\r"
        exp_continue
    }
    "Select the appropriate number" {
        send "2\r"
        exp_continue
    }
    eof
}

puts "\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
puts " âœ… Certificado SSL instalado!"
puts "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"
puts "ğŸ”’ Acesse: https://$domain"
puts "ğŸ”’ Acesse: https://www.$domain\n"
puts "ğŸ“ Certificados renovam automaticamente"
puts "    Verifique: ssh $server_user@$server_ip 'certbot certificates'\n"
